<nz-spin [nzSpinning]="isSpinning">
  <nz-table #sortTable [nzData]="bookings" nzTableLayout="fixed">
    <thead></thead>
    <tbody>
      @for (data of sortTable.data; track data) {
        <div class="booking-card">
          <div nz-row class="booking-row">
            <div nz-col nzSpan="20" class="booking-details">
              <h2 class="status">Status: <b>{{ data.bookCarStatus }}</b></h2>

              <h5>
                Reservé par: <b>{{ data.user!.firstname }} {{ data.user!.lastname }}</b>
                <button nz-button nzType="primary" (click)="openUser(data.user)">Voir le profil</button>
              </h5>

              <h5>
                Véhicule: <b>{{ data.car!.name }}</b> — Modèle: <b>{{ data.car!.brand }}</b>
              </h5>

              <h5>
                De: <b>{{ data.fromDate | date: 'dd-MM-yyyy' }}</b> — Au:
                <b>{{ data.toDate | date: 'dd-MM-yyyy' }}</b> — Jours: <b>{{ data.days }}</b>
              </h5>

              <h5>Prix total: <b>{{ data.price }} €</b></h5>
            </div>

            <div nz-col nzSpan="4" class="booking-actions" *ngIf="data.bookCarStatus == 'PENDING'">
              <button nz-button nzType="primary" nzSize="small"
                      (click)="changeBookingStatus(data.id, 'Approve')">
                Accepter
              </button>
              <button nz-button nzType="default" nzDanger nzSize="small"
                      (click)="changeBookingStatus(data.id, 'Reject')">
                Rejeter
              </button>
            </div>
          </div>
        </div>
      }
    </tbody>
  </nz-table>
</nz-spin>

<nz-drawer
  [nzVisible]="visible"
  [nzWidth]="500"
  [nzClosable]="false"
  (nzOnClose)="closeUser()"
  [nzBodyStyle]="{ padding: '24px' }"
>
  <ng-container *nzDrawerContent>
    <div class="user-profile-drawer">
      <div class="drawer-header">
        <h3>Profil de l'utilisateur</h3>
      </div>

      <div class="drawer-content">
        <div class="profile-field" *ngIf="profile?.lastname">
          <span class="label">Nom :</span>
          <span class="value">{{ profile.lastname }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Prénom :</span>
          <span class="value">{{ profile.firstname }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Téléphone :</span>
          <span class="value">{{ profile.number }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Numéro de permis :</span>
          <span class="value">{{ profile.licenseNumber }}</span>
        </div>

        <div class="profile-field" *ngIf="licenseImage">
          <span class="label">Permis de conduire :</span>
          <img [src]="licenseImage" alt="Permis de conduire" class="license-image" />
        </div>

        <div class="drawer-footer">
          <button nz-button nzType="default" (click)="closeUser()">Fermer</button>
        </div>
      </div>
    </div>
  </ng-container>
</nz-drawer>
