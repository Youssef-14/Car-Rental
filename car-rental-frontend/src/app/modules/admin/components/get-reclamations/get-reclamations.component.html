<nz-spin [nzSpinning]="isSpinning">
  <nz-table #sortTable [nzData]="reclamations" nzTableLayout="fixed">
    <thead></thead>
    <tbody>
    <tr *ngIf="reclamations.length === 0">
      <td colspan="1">
        <div class="empty-list-message">La liste est vide.</div>
      </td>
    </tr>

      @for (data of sortTable.data; track data) {
        <div class="booking-card">
          <div nz-row class="booking-row">
            <div nz-col nzSpan="20" class="booking-details">
              <h2 class="status">Date de la réclamation: {{ data.reclamationDate | date: 'dd-MM-yyyy' }}</h2>

              <!-- detail de la Reclamation-->
              <h3 class="status">Détail de la réclamation: {{ data.description }}</h3>

              <h5>
                Reservé par: <b>{{ data.bookACarDto.user!.firstname }} {{ data.bookACarDto.user!.lastname }}</b>
                <button nz-button nzType="primary" (click)="openUser(data.bookACarDto.user)">Voir le profil</button>
              </h5>

              <h5>
                Véhicule: <b>{{ data.bookACarDto.car!.name }}</b> — Modèle: <b>{{ data.bookACarDto.car!.brand }}</b>
                <button nz-button nzType="primary" (click)="openCar(data.bookACarDto.car)">Voir les détails</button>
              </h5>

              <h5>
                Loué le : <b>{{ data.reclamationDate | date: 'dd-MM-yyyy' }}</b> — Au:
              </h5>
            </div>

            <div nz-col nzSpan="4" class="booking-actions" *ngIf="data.bookCarStatus == 'PENDING'">
              <button nz-button nzType="primary" nzSize="small"
                      (click)="changeBookingStatus(data.id, 'Approve')">
                Accepter
              </button>
              <button nz-button nzType="default" nzDanger nzSize="small"
                      (click)="changeBookingStatus(data.id, 'Reject')">
                Rejeter
              </button>
            </div>
          </div>
        </div>
      }
    </tbody>
  </nz-table>
</nz-spin>

<nz-drawer
  [nzVisible]="visible"
  [nzWidth]="500"
  [nzClosable]="false"
  (nzOnClose)="closeUser()"
  [nzBodyStyle]="{ padding: '24px' }"
>
  <ng-container *nzDrawerContent>
    <div class="user-profile-drawer">
      <div class="drawer-header">
        <h3>Profil de l'utilisateur</h3>
      </div>

      <div class="drawer-content">
        <div class="profile-field" *ngIf="profile?.lastname">
          <span class="label">Nom :</span>
          <span class="value">{{ profile?.lastname }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Prénom :</span>
          <span class="value">{{ profile?.firstname }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Téléphone :</span>
          <span class="value">{{ profile?.number }}</span>
        </div>

        <!-- Adresse conditionnelle pour afficher l'adresse si elle est disponible -->
        <div class="profile-field" *ngIf="profile?.address">
          <span class="label">Adresse :</span>
          <span class="value">{{ profile?.address }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Email :</span>
          <span class="value">{{ profile?.email }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Numéro de permis :</span>
          <span class="value">{{ profile?.licenseNumber }}</span>
        </div>

        <div class="profile-field" *ngIf="licenseImage">
          <span class="label">Permis de conduire :</span>
          <img [src]="licenseImage" alt="Permis de conduire" class="license-image" />
        </div>

        <div class="drawer-footer">
          <button nz-button nzType="default" (click)="closeUser()">Fermer</button>
        </div>
      </div>
    </div>
  </ng-container>
</nz-drawer>


<nz-drawer
  [nzVisible]="visibleCar"
  [nzWidth]="500"
  [nzClosable]="false"
  (nzOnClose)="closeCar()"
  [nzBodyStyle]="{ padding: '24px' }"
>
  <ng-container *nzDrawerContent>
    <div class="user-profile-drawer">
      <div class="drawer-header">
        <h3>Détails du véhicule</h3>
      </div>

      <div class="drawer-content">
        <div class="profile-field" *ngIf="car?.brand">
          <span class="label">Brand :</span>
          <span class="value">{{ car?.brand }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Nom :</span>
          <span class="value">{{ car?.name }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Année :</span>
          <span class="value">{{ car?.year }}</span>
        </div>

        <div class="profile-field">
          <span class="label">Transmission :</span>
          <span class="value">{{ car?.transmission }}</span>
        </div>

        <div class="profile-field" *ngIf="carImage">
          <span class="label">Image de la véhicule :</span>
          <img [src]="carImage" alt="Image de la véhicule" class="license-image" />
        </div>

        <div class="drawer-footer">
          <button nz-button nzType="default" (click)="closeCar()">Fermer</button>
        </div>
      </div>
    </div>
  </ng-container>
</nz-drawer>
